flowchart TB
    subgraph Client["客户端"]
        UI[用户界面]
        AudioRec[音频录制组件]
        VideoPlayer[视频播放器]
        
        UI --> AudioRec
        UI --> VideoPlayer
    end
    
    subgraph Server["服务端"]
        API[API网关]
        
        subgraph STTService["语音识别服务"]
            WhisperAPI[Whisper API]
            LocalWhisper[本地Whisper模型]
        end
        
        subgraph LLMService["大语言模型服务"]
            OpenAI[OpenAI API]
            LocalLLM[本地LLM模型]
            History[对话历史管理]
        end
        
        subgraph TTSService["语音合成服务"]
            TTSAPI[TTS API]
            LocalTTS[本地TTS引擎]
        end
        
        subgraph VideoGen["视频生成服务"]
            EchoMimic[EchoMimic引擎]
            ReferenceDB[参考图像库]
            PoseDB[姿态数据库]
        end
        
        TaskQueue[任务队列]
        Cache[缓存系统]
        Storage[对象存储]
    end
    
    %% 连接关系
    AudioRec -.->|音频数据| API
    API --> STTService
    STTService --> LLMService
    LLMService --> TTSService
    TTSService --> VideoGen
    VideoGen -.->|视频URL| API
    API -.->|视频数据| VideoPlayer
    
    API <--> TaskQueue
    TaskQueue <--> STTService
    TaskQueue <--> LLMService
    TaskQueue <--> TTSService
    TaskQueue <--> VideoGen
    
    STTService <--> Cache
    LLMService <--> Cache
    TTSService <--> Cache
    VideoGen <--> Cache
    
    EchoMimic --> Storage
    ReferenceDB --> EchoMimic
    PoseDB --> EchoMimic
    Storage -.->|媒体文件| API
    
    %% 样式定义
    classDef client fill:#d5e8d4,stroke:#82b366
    classDef server fill:#dae8fc,stroke:#6c8ebf
    classDef service fill:#fff2cc,stroke:#d6b656
    classDef storage fill:#f8cecc,stroke:#b85450
    
    class Client client
    class Server server
    class STTService,LLMService,TTSService,VideoGen service
    class ReferenceDB,PoseDB,Cache,Storage,History storage