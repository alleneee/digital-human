{"ast":null,"code":"var _jsxFileName = \"/Users/niko/digital-human/frontend/src/components/RecordButton/index.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useWebSocket } from '../../contexts/WebsocketContext';\nimport './RecordButton.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst RecordButton = () => {\n  _s();\n  const {\n    sendAudio,\n    isProcessing\n  } = useWebSocket();\n  const [isRecording, setIsRecording] = useState(false);\n  const [recorder, setRecorder] = useState(null);\n  const [stream, setStream] = useState(null);\n\n  // 初始化麦克风权限\n  useEffect(() => {\n    return () => {\n      // 组件卸载时释放资源\n      if (stream) {\n        stream.getTracks().forEach(track => track.stop());\n      }\n      if (recorder) {\n        recorder.ondataavailable = null;\n        recorder.onstop = null;\n      }\n    };\n  }, [recorder, stream]);\n\n  // 开始录音\n  const startRecording = async () => {\n    try {\n      const audioStream = await navigator.mediaDevices.getUserMedia({\n        audio: true\n      });\n      setStream(audioStream);\n      const mediaRecorder = new MediaRecorder(audioStream);\n      setRecorder(mediaRecorder);\n      const audioChunks = [];\n      mediaRecorder.ondataavailable = e => {\n        if (e.data.size > 0) {\n          audioChunks.push(e.data);\n        }\n      };\n      mediaRecorder.onstop = () => {\n        const audioBlob = new Blob(audioChunks, {\n          type: 'audio/wav'\n        });\n        sendAudio(audioBlob);\n        setIsRecording(false);\n      };\n      mediaRecorder.start();\n      setIsRecording(true);\n    } catch (err) {\n      console.error('无法访问麦克风:', err);\n      alert('无法访问麦克风，请确保已授予麦克风权限');\n      setIsRecording(false);\n    }\n  };\n\n  // 停止录音\n  const stopRecording = () => {\n    if (recorder && recorder.state !== 'inactive') {\n      recorder.stop();\n      if (stream) {\n        stream.getTracks().forEach(track => track.stop());\n        setStream(null);\n      }\n    }\n  };\n\n  // 处理录音按钮点击\n  const handleRecordClick = () => {\n    if (isRecording) {\n      stopRecording();\n    } else {\n      startRecording();\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"button\", {\n    className: `record-button ${isRecording ? 'recording' : ''} ${isProcessing ? 'disabled' : ''}`,\n    onClick: handleRecordClick,\n    disabled: isProcessing,\n    children: isRecording ? '停止录音' : '开始录音'\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 79,\n    columnNumber: 5\n  }, this);\n};\n_s(RecordButton, \"B8UfpRYjy/ROBv/Qb4ujg6F164Q=\", false, function () {\n  return [useWebSocket];\n});\n_c = RecordButton;\nexport default RecordButton;\nvar _c;\n$RefreshReg$(_c, \"RecordButton\");","map":{"version":3,"names":["React","useState","useEffect","useWebSocket","jsxDEV","_jsxDEV","RecordButton","_s","sendAudio","isProcessing","isRecording","setIsRecording","recorder","setRecorder","stream","setStream","getTracks","forEach","track","stop","ondataavailable","onstop","startRecording","audioStream","navigator","mediaDevices","getUserMedia","audio","mediaRecorder","MediaRecorder","audioChunks","e","data","size","push","audioBlob","Blob","type","start","err","console","error","alert","stopRecording","state","handleRecordClick","className","onClick","disabled","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/niko/digital-human/frontend/src/components/RecordButton/index.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useWebSocket } from '../../contexts/WebsocketContext';\nimport './RecordButton.css';\n\nconst RecordButton = () => {\n  const { sendAudio, isProcessing } = useWebSocket();\n  const [isRecording, setIsRecording] = useState(false);\n  const [recorder, setRecorder] = useState(null);\n  const [stream, setStream] = useState(null);\n  \n  // 初始化麦克风权限\n  useEffect(() => {\n    return () => {\n      // 组件卸载时释放资源\n      if (stream) {\n        stream.getTracks().forEach(track => track.stop());\n      }\n      if (recorder) {\n        recorder.ondataavailable = null;\n        recorder.onstop = null;\n      }\n    };\n  }, [recorder, stream]);\n  \n  // 开始录音\n  const startRecording = async () => {\n    try {\n      const audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      setStream(audioStream);\n      \n      const mediaRecorder = new MediaRecorder(audioStream);\n      setRecorder(mediaRecorder);\n      \n      const audioChunks = [];\n      \n      mediaRecorder.ondataavailable = (e) => {\n        if (e.data.size > 0) {\n          audioChunks.push(e.data);\n        }\n      };\n      \n      mediaRecorder.onstop = () => {\n        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });\n        sendAudio(audioBlob);\n        setIsRecording(false);\n      };\n      \n      mediaRecorder.start();\n      setIsRecording(true);\n    } catch (err) {\n      console.error('无法访问麦克风:', err);\n      alert('无法访问麦克风，请确保已授予麦克风权限');\n      setIsRecording(false);\n    }\n  };\n  \n  // 停止录音\n  const stopRecording = () => {\n    if (recorder && recorder.state !== 'inactive') {\n      recorder.stop();\n      \n      if (stream) {\n        stream.getTracks().forEach(track => track.stop());\n        setStream(null);\n      }\n    }\n  };\n  \n  // 处理录音按钮点击\n  const handleRecordClick = () => {\n    if (isRecording) {\n      stopRecording();\n    } else {\n      startRecording();\n    }\n  };\n  \n  return (\n    <button \n      className={`record-button ${isRecording ? 'recording' : ''} ${isProcessing ? 'disabled' : ''}`}\n      onClick={handleRecordClick}\n      disabled={isProcessing}\n    >\n      {isRecording ? '停止录音' : '开始录音'}\n    </button>\n  );\n};\n\nexport default RecordButton;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}