{"ast":null,"code":"var _jsxFileName = \"/Users/niko/digital-human/frontend/src/components/RecordButton/index.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { useWebRTC } from '../../contexts/WebRTCContext';\nimport { useWebSocket } from '../../contexts/WebSocketContext';\nimport './RecordButton.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst RecordButton = () => {\n  _s();\n  const {\n    isRecording,\n    toggleRecording,\n    isReady,\n    audioLevel,\n    lowVolumeWarning\n  } = useWebRTC();\n  const {\n    isProcessing,\n    webrtcSupported,\n    connectionStatus,\n    hasPendingMessages\n  } = useWebSocket();\n  const [volumeLevel, setVolumeLevel] = useState(0);\n\n  // 处理音量显示动画\n  useEffect(() => {\n    // 平滑音量变化\n    setVolumeLevel(prev => audioLevel ? Math.max(prev * 0.7, audioLevel * 0.3) : prev * 0.9);\n  }, [audioLevel]);\n\n  // 处理录音按钮点击\n  const handleRecordClick = () => {\n    toggleRecording();\n  };\n\n  // 根据支持的功能和状态显示不同的按钮文本\n  const getButtonText = () => {\n    if (!isReady) {\n      return '麦克风不可用';\n    }\n    if (connectionStatus === 'offline') {\n      return '网络已断开';\n    }\n    if (connectionStatus === 'reconnecting') {\n      return '正在重连...';\n    }\n    if (hasPendingMessages) {\n      return isRecording ? '停止录音 (离线)' : '开始录音 (离线)';\n    }\n    return isRecording ? '停止录音' : '开始录音';\n  };\n\n  // 是否禁用按钮\n  const isButtonDisabled = () => {\n    return isProcessing || !isReady || connectionStatus === 'offline';\n  };\n\n  // 获取音量等级条的样式\n  const getVolumeBarStyle = () => {\n    if (!isRecording) return {};\n\n    // 计算高度百分比(0-100)\n    const height = Math.min(Math.max(volumeLevel * 2, 5), 100);\n    return {\n      height: `${height}%`,\n      backgroundColor: lowVolumeWarning ? '#ff9800' : '#4caf50'\n    };\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"record-button-container\",\n    children: [isRecording && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"volume-indicator\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"volume-bar\",\n        style: getVolumeBarStyle()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 62,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: `record-button ${isRecording ? 'recording' : ''} \n          ${isButtonDisabled() ? 'disabled' : ''} \n          ${connectionStatus !== 'online' ? 'network-issue' : ''}\n          ${lowVolumeWarning ? 'low-volume' : ''}\n          ${hasPendingMessages ? 'pending-messages' : ''}`,\n      onClick: handleRecordClick,\n      disabled: isButtonDisabled(),\n      title: !isReady ? '您的浏览器不支持语音功能或麦克风不可用' : connectionStatus !== 'online' ? '网络连接已断开，正在尝试重连' : lowVolumeWarning ? '检测到音量过低，请靠近麦克风或调高音量' : hasPendingMessages ? '您有待发送的消息，将在网络恢复后自动发送' : isRecording ? '点击停止录音' : '点击开始录音',\n      children: [getButtonText(), connectionStatus !== 'online' && /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"connection-indicator\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 11\n      }, this), isRecording && lowVolumeWarning && /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"volume-warning\",\n        children: \"\\u97F3\\u91CF\\u4F4E\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }, this), hasPendingMessages && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pending-message-indicator\",\n      title: \"\\u6709\\u5F85\\u53D1\\u9001\\u7684\\u6D88\\u606F\\uFF0C\\u7F51\\u7EDC\\u6062\\u590D\\u540E\\u5C06\\u81EA\\u52A8\\u53D1\\u9001\",\n      children: [\"\\u5F85\\u53D1\\u9001: \", hasPendingMessages ? '有' : '无']\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 58,\n    columnNumber: 5\n  }, this);\n};\n_s(RecordButton, \"x1J82CZatSQT92hD0+zCYNy2jOo=\", false, function () {\n  return [useWebRTC, useWebSocket];\n});\n_c = RecordButton;\nexport default RecordButton;\nvar _c;\n$RefreshReg$(_c, \"RecordButton\");","map":{"version":3,"names":["React","useEffect","useState","useWebRTC","useWebSocket","jsxDEV","_jsxDEV","RecordButton","_s","isRecording","toggleRecording","isReady","audioLevel","lowVolumeWarning","isProcessing","webrtcSupported","connectionStatus","hasPendingMessages","volumeLevel","setVolumeLevel","prev","Math","max","handleRecordClick","getButtonText","isButtonDisabled","getVolumeBarStyle","height","min","backgroundColor","className","children","style","fileName","_jsxFileName","lineNumber","columnNumber","onClick","disabled","title","_c","$RefreshReg$"],"sources":["/Users/niko/digital-human/frontend/src/components/RecordButton/index.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useWebRTC } from '../../contexts/WebRTCContext';\nimport { useWebSocket } from '../../contexts/WebSocketContext';\nimport './RecordButton.css';\n\nconst RecordButton = () => {\n  const { isRecording, toggleRecording, isReady, audioLevel, lowVolumeWarning } = useWebRTC();\n  const { isProcessing, webrtcSupported, connectionStatus, hasPendingMessages } = useWebSocket();\n  const [volumeLevel, setVolumeLevel] = useState(0);\n  \n  // 处理音量显示动画\n  useEffect(() => {\n    // 平滑音量变化\n    setVolumeLevel(prev => audioLevel ? Math.max(prev * 0.7, audioLevel * 0.3) : prev * 0.9);\n  }, [audioLevel]);\n  \n  // 处理录音按钮点击\n  const handleRecordClick = () => {\n    toggleRecording();\n  };\n  \n  // 根据支持的功能和状态显示不同的按钮文本\n  const getButtonText = () => {\n    if (!isReady) {\n      return '麦克风不可用';\n    }\n    if (connectionStatus === 'offline') {\n      return '网络已断开';\n    }\n    if (connectionStatus === 'reconnecting') {\n      return '正在重连...';\n    }\n    if (hasPendingMessages) {\n      return isRecording ? '停止录音 (离线)' : '开始录音 (离线)';\n    }\n    return isRecording ? '停止录音' : '开始录音';\n  };\n  \n  // 是否禁用按钮\n  const isButtonDisabled = () => {\n    return isProcessing || !isReady || connectionStatus === 'offline';\n  };\n  \n  // 获取音量等级条的样式\n  const getVolumeBarStyle = () => {\n    if (!isRecording) return {};\n    \n    // 计算高度百分比(0-100)\n    const height = Math.min(Math.max(volumeLevel * 2, 5), 100);\n    \n    return {\n      height: `${height}%`,\n      backgroundColor: lowVolumeWarning ? '#ff9800' : '#4caf50'\n    };\n  };\n  \n  return (\n    <div className=\"record-button-container\">\n      {/* 音量显示条 */}\n      {isRecording && (\n        <div className=\"volume-indicator\">\n          <div className=\"volume-bar\" style={getVolumeBarStyle()}></div>\n        </div>\n      )}\n      \n      {/* 主录音按钮 */}\n      <button \n        className={`record-button ${isRecording ? 'recording' : ''} \n          ${isButtonDisabled() ? 'disabled' : ''} \n          ${connectionStatus !== 'online' ? 'network-issue' : ''}\n          ${lowVolumeWarning ? 'low-volume' : ''}\n          ${hasPendingMessages ? 'pending-messages' : ''}`}\n        onClick={handleRecordClick}\n        disabled={isButtonDisabled()}\n        title={\n          !isReady ? '您的浏览器不支持语音功能或麦克风不可用' : \n          connectionStatus !== 'online' ? '网络连接已断开，正在尝试重连' :\n          lowVolumeWarning ? '检测到音量过低，请靠近麦克风或调高音量' :\n          hasPendingMessages ? '您有待发送的消息，将在网络恢复后自动发送' :\n          (isRecording ? '点击停止录音' : '点击开始录音')\n        }\n      >\n        {getButtonText()}\n        \n        {/* 连接状态指示器 */}\n        {connectionStatus !== 'online' && (\n          <span className=\"connection-indicator\"></span>\n        )}\n        \n        {/* 低音量警告 */}\n        {isRecording && lowVolumeWarning && (\n          <span className=\"volume-warning\">音量低</span>\n        )}\n      </button>\n      \n      {/* 待发送消息指示器 */}\n      {hasPendingMessages && (\n        <div className=\"pending-message-indicator\" title=\"有待发送的消息，网络恢复后将自动发送\">\n          待发送: {hasPendingMessages ? '有' : '无'}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default RecordButton;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}